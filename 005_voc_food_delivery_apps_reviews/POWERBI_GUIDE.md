# PowerBI RDI 대시보드 구축 가이드

## 📊 개요
이 가이드는 Python으로 생성한 RDI(Risk Detection Index) 점수를 PowerBI에서 시각화하는 방법을 설명합니다.

## 📁 생성된 파일

### 1. RDI 분석 결과 파일
- **파일 위치**: `data/processed/rdi_output.csv`
- **총 레코드 수**: 4,590일 (2011-07-22 ~ 2024-02-13)
- **컬럼 구조**:
  - `Review_ID`: 고유 식별자 (1부터 순차 증가)
  - `date`: 날짜 (YYYY-MM-DD 형식)
  - `rdi_score`: RDI 위험 점수 (0~100, 높을수록 향후 7일 이내 VOC 폭발 가능성 높음)
- **참고**: `voc_cnt`는 원본 리뷰 데이터에서 PowerBI DAX로 계산합니다

### 2. 원본 리뷰 데이터 (Review_ID 추가)
- **파일 위치**: `data/raw/food_delivery_apps_with_id.csv`
- **총 레코드 수**: 1,247,061개 리뷰
- **새 컬럼**: `Review_ID` (1부터 순차 증가, 각 리뷰의 고유 식별자)
- **백업 파일**: `data/raw/food_delivery_apps_backup.csv` (원본 보존)

## 🔍 모델 성능
- **ROC-AUC**: 0.9439 (매우 우수)
- **Train 기간**: 2011-07-22 ~ 2019-12-31
- **Test 기간**: 2020-01-01 ~ 2024-02-13
- **예측 대상**: 향후 7일 이내 VOC 폭발 여부 (상위 10% 임계값 기준)

## 🎯 RDI 점수 해석
- **0~20**: 안전 (낮은 위험)
- **20~40**: 주의 (보통 위험)
- **40~60**: 경고 (높은 위험)
- **60~100**: 위험 (매우 높은 위험, 즉시 대응 필요)

RDI 점수 평균: 20.4 (전체 기간)

## 📥 PowerBI 데이터 불러오기

### 1단계: 원본 리뷰 데이터 가져오기 (필수)
1. PowerBI Desktop 실행
2. **홈** 탭 → **데이터 가져오기** → **텍스트/CSV** 선택
3. 파일 선택: `C:\dev\k_rdi_backtest\data\raw\food_delivery_apps_with_id.csv`
4. **로드** 클릭
5. 테이블 이름: `Reviews` (또는 원하는 이름)

**참고**: 1,247,061개의 레코드이므로 로딩에 시간이 걸릴 수 있습니다.

### 2단계: RDI 점수 데이터 가져오기
1. **홈** 탭 → **데이터 가져오기** → **텍스트/CSV** 선택
2. 파일 선택: `C:\dev\k_rdi_backtest\data\processed\rdi_output.csv`
3. **로드** 클릭
4. 테이블 이름: `RDI_Scores` (또는 원하는 이름)

### 3단계: 데이터 타입 확인
**Reviews 테이블**:
- `Review_ID`: **정수** 타입
- `date`: **날짜/시간** 타입
- `score` (rating): **정수** 타입
- `content` (review_text): **텍스트** 타입

**RDI_Scores 테이블**:
- `Review_ID`: **정수** 타입
- `date`: **날짜** 타입
- `rdi_score`: **10진수** 타입

### 4단계: 날짜 테이블 생성 (권장)
날짜 기반 분석을 위해 날짜 테이블을 생성합니다:

1. **모델링** 탭 → **새 테이블** 클릭
2. 다음 DAX 입력:
```dax
DateTable =
ADDCOLUMNS(
    CALENDAR(
        DATE(2011, 7, 21),
        DATE(2024, 2, 13)
    ),
    "Year", YEAR([Date]),
    "Month", MONTH([Date]),
    "MonthName", FORMAT([Date], "MMM"),
    "Quarter", "Q" & QUARTER([Date]),
    "DayOfWeek", WEEKDAY([Date]),
    "DayName", FORMAT([Date], "ddd")
)
```

### 5단계: 관계 설정
**모델** 뷰로 이동하여 관계를 설정합니다:

1. **DateTable[Date]** ↔ **Reviews[date]** (다대일)
2. **DateTable[Date]** ↔ **RDI_Scores[date]** (일대일)

## 📊 시각화 구성

### 추천 차트 1: 콤보 차트 (VOC 건수 + RDI 점수)
이 차트는 사진에 나온 것과 동일한 형태입니다.

1. **시각화** → **세로 막대형 및 꺾은선형 차트** 선택
2. 필드 설정:
   - **공유 축**: `DateTable[Date]`
   - **열 값**: `[VOC 일별 건수]` (측정값, 막대그래프)
   - **선 값**: `[RDI 점수]` (측정값, 꺾은선 그래프)
3. 서식 설정:
   - **열 (막대)**: 파란색, 투명도 30%
   - **선 (RDI)**: 빨간색, 두께 2-3px
   - **데이터 레이블**: 선택사항
   - **범례**: 상단 또는 하단 표시
4. 슬라이서로 최근 6개월 필터링

### 추천 차트 2: RDI 점수 게이지 (현재 위험도)
1. **시각화** → **계기** 선택
2. 필드 설정:
   - **값**: `[최신 RDI 점수]` (측정값)
   - **최소값**: 0
   - **최대값**: 100
3. 색상 구간 설정:
   - 0-20: 초록색 (안전)
   - 20-40: 노란색 (주의)
   - 40-60: 주황색 (경고)
   - 60-100: 빨간색 (위험)

### 추천 차트 3: 테이블 (상위 위험일)
1. **시각화** → **테이블** 선택
2. 필드:
   - `DateTable[Date]`
   - `[RDI 점수]` (측정값)
   - `[VOC 일별 건수]` (측정값)
3. 정렬: `[RDI 점수]` 내림차순
4. 필터: 상위 10개만 표시

### 추천 차트 4: 카드 (KPI)
여러 개의 카드를 만들어 주요 지표를 표시합니다:
- **최신 RDI 점수**: `[최신 RDI 점수]`
- **평균 RDI**: `[평균 RDI]`
- **고위험일 수**: `[고위험일 수]`
- **VOC 총 건수**: `[VOC 일별 건수]` (합계)
- **VOC 비율**: `[VOC 비율]`

## 🔧 필터 및 슬라이서 설정

### 날짜 슬라이서 (최근 6개월)
1. **시각화** → **슬라이서** 선택
2. 필드: `date`
3. 슬라이서 유형: **날짜 범위 슬라이더** 또는 **날짜 범위 선택**
4. 기본값 설정:
   - **상대 날짜 필터** 사용
   - "지난 6개월" 또는 "지난 180일" 선택

### RDI 점수 임계값 슬라이서
1. **시각화** → **슬라이서** 선택
2. 필드: `rdi_score`
3. 슬라이서 유형: **범위 슬라이더**
4. 기본값: 0 ~ 100

## 📈 필수 DAX 측정값

PowerBI에서 VOC 건수와 다양한 지표를 계산하기 위한 DAX 측정값입니다.

### 1. VOC 일별 건수 (필수)
원본 리뷰 데이터에서 VOC(rating ≤ 2)를 일별로 집계합니다:

```dax
VOC 일별 건수 =
CALCULATE(
    COUNTROWS(Reviews),
    Reviews[score] <= 2
)
```

### 2. 전체 리뷰 건수
```dax
전체 리뷰 건수 = COUNTROWS(Reviews)
```

### 3. VOC 비율
```dax
VOC 비율 =
DIVIDE(
    [VOC 일별 건수],
    [전체 리뷰 건수],
    0
) * 100
```

### 4. RDI 점수 (현재 선택된 날짜)
```dax
RDI 점수 =
MAX(RDI_Scores[rdi_score])
```

### 5. 최신 RDI 점수
```dax
최신 RDI 점수 =
CALCULATE(
    MAX(RDI_Scores[rdi_score]),
    FILTER(
        ALL(RDI_Scores),
        RDI_Scores[date] = MAX(RDI_Scores[date])
    )
)
```

### 6. 평균 RDI 점수 (선택된 기간)
```dax
평균 RDI = AVERAGE(RDI_Scores[rdi_score])
```

### 7. 고위험일 수 (RDI ≥ 60)
```dax
고위험일 수 =
CALCULATE(
    COUNTROWS(RDI_Scores),
    RDI_Scores[rdi_score] >= 60
)
```

### 8. 위험도 카테고리 (계산 열 - RDI_Scores 테이블)
```dax
위험도 =
SWITCH(
    TRUE(),
    RDI_Scores[rdi_score] >= 60, "위험",
    RDI_Scores[rdi_score] >= 40, "경고",
    RDI_Scores[rdi_score] >= 20, "주의",
    "안전"
)
```

### 9. VOC 7일 이동평균
```dax
VOC 7일 MA =
AVERAGEX(
    DATESINPERIOD(
        DateTable[Date],
        MAX(DateTable[Date]),
        -7,
        DAY
    ),
    [VOC 일별 건수]
)
```

### 10. RDI 7일 이동평균
```dax
RDI 7일 MA =
AVERAGEX(
    DATESINPERIOD(
        DateTable[Date],
        MAX(DateTable[Date]),
        -7,
        DAY
    ),
    [RDI 점수]
)
```

## 🎨 대시보드 레이아웃 예시

```
┌─────────────────────────────────────────────────────────────┐
│  📊 VOC-RDI 모니터링 대시보드                                │
├─────────────────────────────────────────────────────────────┤
│  날짜 필터: [━━━━━━━━━━━] (최근 6개월)                      │
├──────────────────┬──────────────────────────────────────────┤
│  현재 RDI 점수    │  VOC 일별 건수와 RDI 스코어              │
│  [   45.2  ]     │  (최근 6개월)                            │
│  (게이지)        │                                          │
│                  │  200│  ▅▃                       ▅▆       │
│  평균 RDI: 20.4  │     │ ▂█▅▃▂▁ ▃      ▂  ▁▂ ▃  ▂▇█▅       │
│  고위험일: 5일   │  100│▁██████▆█▃▁▂▁▂██▃▁██▆█▂▁▅███▄       │
│                  │   0 └───────────────────────────────────  │
│                  │       9월  10월  11월  12월   1월   2월  │
│                  │     RDI 점수: ──────── (오른쪽 축)       │
├──────────────────┴──────────────────────────────────────────┤
│  상위 위험일 TOP 10                                          │
│  ┌────────────┬──────────┬───────────┬────────┐            │
│  │ Review_ID  │   날짜   │ RDI 점수  │ VOC 수 │            │
│  ├────────────┼──────────┼───────────┼────────┤            │
│  │    3542    │2023-12-15│   95.3    │  412   │            │
│  │    3421    │2023-11-28│   87.6    │  389   │            │
│  │     ...    │   ...    │   ...     │  ...   │            │
│  └────────────┴──────────┴───────────┴────────┘            │
└─────────────────────────────────────────────────────────────┘
```

## 🔄 데이터 새로고침

### 자동 새로고침 설정 (PowerBI Service)
1. PowerBI Service에 보고서 게시
2. **데이터 세트 설정** → **예약된 새로 고침** 설정
3. Python 스크립트를 주기적으로 실행하도록 스케줄링 (예: Windows 작업 스케줄러)

### 수동 새로고침
1. Python 스크립트 실행:
   ```bash
   python generate_rdi_csv_for_powerbi.py
   ```
2. PowerBI Desktop에서 **새로 고침** 버튼 클릭

## ⚠️ 주의사항

1. **날짜 형식**: CSV 파일의 날짜는 `YYYY-MM-DD` 형식입니다. PowerBI에서 날짜로 자동 인식됩니다.
2. **인코딩**: CSV 파일은 UTF-8 BOM으로 저장되어 한글 깨짐 문제가 없습니다.
3. **데이터 범위**: 전체 데이터는 2011년부터 시작하지만, 실제 분석은 최근 6개월~1년 데이터를 권장합니다.
4. **RDI 점수 해석**: RDI 점수가 높다고 무조건 VOC 폭발이 발생하는 것은 아닙니다. 모델의 정확도는 94.4%이지만, False Positive가 발생할 수 있습니다.
5. **Review_ID**: RDI CSV의 Review_ID는 날짜별 레코드의 순차 번호입니다. 원본 리뷰 데이터의 Review_ID와는 다른 개념입니다.

## 🚀 추가 분석 아이디어

1. **요일별 패턴 분석**: VOC와 RDI 점수의 요일별 평균 비교
2. **월별 트렌드**: 월별 평균 RDI 점수 및 VOC 건수 추이
3. **경보 정확도 추적**: RDI 상위 10% 구간의 실제 VOC 폭발 발생률 모니터링
4. **임계값 조정**: RDI 점수 임계값을 조정하여 경보 민감도 변경
5. **원본 리뷰와 연결**: 고위험일의 실제 리뷰 내용 분석 (원본 CSV와 날짜로 조인)

## 📞 문의 및 이슈

모델 재학습이 필요하거나 새로운 데이터로 CSV를 업데이트하려면:
- **RDI 데이터 재생성**: `python generate_rdi_csv_for_powerbi.py`
- **원본 리뷰에 Review_ID 추가**: `python add_review_id.py`

---

**생성일**: 2026-01-13
**스크립트**:
- `generate_rdi_csv_for_powerbi.py` (RDI 데이터)
- `add_review_id.py` (원본 리뷰 ID 추가)

**출력 파일**:
- `data/processed/rdi_output.csv` (RDI 분석)
- `data/raw/food_delivery_apps_with_id.csv` (원본 리뷰 with ID)
