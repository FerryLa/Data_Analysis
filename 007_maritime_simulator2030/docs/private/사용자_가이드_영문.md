# Maritime Communication Simulator 2030 - 사용자 가이드

## 목차

1. [빠른 시작](#빠른-시작)
2. [시스템 요구사항](#시스템-요구사항)
3. [설치 방법](#설치-방법)
4. [API 키 설정](#api-키-설정)
5. [시뮬레이터 실행](#시뮬레이터-실행)
6. [주요 기능](#주요-기능)
7. [시나리오 설정](#시나리오-설정)
8. [문제 해결](#문제-해결)

---

## 빠른 시작

### 1분 안에 시작하기

```bash
# 1. 리포지토리 클론 또는 디렉토리 이동
cd maritime_comm_simulator_2030

# 2. 가상 환경 생성 (선택 사항이지만 권장)
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. 의존성 설치
pip install -r requirements.txt

# 4. 환경 변수 설정
cp .env.example .env
# .env 파일을 열고 AISSTREAM_API_KEY를 입력하세요

# 5. 시뮬레이터 실행
streamlit run app.py
```

브라우저에서 자동으로 `http://localhost:8501`이 열립니다.

---

## 시스템 요구사항

### 필수 요구사항

- **Python**: 3.10 이상
- **운영체제**: Windows, macOS, Linux
- **메모리**: 최소 4GB RAM (8GB 권장)
- **네트워크**: 인터넷 연결 (AIS 실시간 데이터용)

### 권장 환경

- **브라우저**: Chrome, Firefox, Edge (최신 버전)
- **디스플레이**: 1920x1080 이상

---

## 설치 방법

### 방법 1: pip를 사용한 설치

```bash
pip install -r requirements.txt
```

### 방법 2: conda를 사용한 설치

```bash
conda create -n maritime_sim python=3.10
conda activate maritime_sim
pip install -r requirements.txt
```

### 설치 확인

```bash
python -c "import streamlit; import folium; import shapely; print('설치 성공!')"
```

---

## API 키 설정

### AISStream API 키 발급

1. [https://aisstream.io/](https://aisstream.io/)에 접속
2. 무료 계정 생성 (이메일만 필요)
3. API 키 복사

### 환경 변수 설정

`.env` 파일 생성:

```bash
cp .env.example .env
```

`.env` 파일 편집:

```bash
AISSTREAM_API_KEY=여기에_실제_API_키_입력
ENABLE_REAL_AIS=true
SIMULATION_UPDATE_INTERVAL_SEC=10
LOG_LEVEL=INFO
```

**중요**: `.env` 파일은 절대 git에 커밋하지 마세요 (이미 .gitignore에 포함됨).

---

## 시뮬레이터 실행

### Streamlit 웹 애플리케이션 실행

```bash
streamlit run app.py
```

브라우저에서 자동으로 열립니다. 수동으로 열려면:

```
http://localhost:8501
```

### 개별 모듈 테스트

각 모듈은 독립적으로 실행 가능합니다:

```bash
# Dead Reckoning 엔진 테스트
python prediction_engine.py

# 암모니아 선박 시뮬레이션 테스트
python simulation_ammonia.py

# SMR 선박 시뮬레이션 테스트
python simulation_smr.py

# 시나리오 컨트롤러 테스트
python scenario_controller.py

# AIS 클라이언트 테스트 (API 키 필요)
export AISSTREAM_API_KEY=your_key
python ais_client.py
```

---

## 주요 기능

### 1. 실시간 선박 추적

- **Q-Max LNG 선박 14척**: AISStream을 통한 실시간 AIS 데이터
- **암모니아 선박 5척**: 경로 기반 시뮬레이션
- **SMR 선박 1척**: 통로 제약 시뮬레이션

### 2. Dead Reckoning 예측

- AIS 신호 손실 시 선박 위치 예측
- 95% 신뢰 구간 오차 반경 표시
- 환경 드리프트 (바람, 해류) 모델링

### 3. 통신 시나리오

#### 사용 가능한 시나리오:

1. **정상 조건**
   - VSAT 통신
   - 중간 해상 상태
   - 저하 수준: 0%

2. **악천후**
   - VSAT 통신
   - 매우 거친 해상
   - 풍속: 45 knots
   - 저하 수준: 60%

3. **LEO 위성 핸드오버**
   - Starlink/OneWeb 스타일 통신
   - 위성 간 핸드오버 시뮬레이션
   - 저하 수준: 30%

4. **중대 장애**
   - AIS 지상국만 사용
   - 높은 해상 상태
   - 저하 수준: 90%
   - 강제 블랙아웃 10분

### 4. 지오펜스 모니터링

SMR 선박의 항로 제약 및 위반 감지:

- **금지 구역**: 진입 불가
- **제한 구역**: 속도 제한 및 필수 보고
- **통로 이탈**: 중심선으로부터 거리 모니터링

### 5. 성능 지표

- **신호 가용성 지수 (SAI)**: 0-100%
- **평균 지연**: 밀리초 단위
- **패킷 손실률**: 백분율
- **예측 오차**: 미터 단위

---

## 시나리오 설정

### 사이드바에서 제어

1. **시나리오 선택**
   - 드롭다운에서 원하는 시나리오 선택

2. **저하 수준 조정**
   - 슬라이더로 0.0 (정상) ~ 1.0 (최대 저하) 설정

3. **시뮬레이션 제어**
   - ▶️ 시작: 시뮬레이션 실행
   - ⏸️ 정지: 시뮬레이션 일시 정지

### 프로그래밍 방식 시나리오 생성

`scenario_controller.py`를 사용한 커스텀 시나리오:

```python
from scenario_controller import ScenarioConfig, CommunicationProfile, SeaState

custom_scenario = ScenarioConfig(
    scenario_name="Custom Scenario",
    communication_profile=CommunicationProfile.get_vsat(),
    sea_state=SeaState.ROUGH,
    wind_speed_knots=30.0,
    degradation_level=0.5
)

controller = ScenarioController(custom_scenario)
```

---

## 문제 해결

### Q: AIS 데이터가 수신되지 않아요

**A**: 다음을 확인하세요:

1. `.env` 파일에 올바른 API 키가 설정되어 있는지 확인
   ```bash
   cat .env | grep AISSTREAM_API_KEY
   ```

2. 인터넷 연결 확인

3. AISStream 서비스 상태 확인: [https://status.aisstream.io/](https://status.aisstream.io/)

4. 방화벽이 WebSocket 연결을 차단하지 않는지 확인

5. 로그 확인:
   ```bash
   # 로그 레벨을 DEBUG로 변경
   LOG_LEVEL=DEBUG streamlit run app.py
   ```

### Q: 지도가 표시되지 않아요

**A**:

1. 인터넷 연결 확인 (Folium은 온라인 타일 사용)

2. 브라우저 콘솔 오류 확인 (F12)

3. Streamlit 캐시 삭제:
   ```bash
   streamlit cache clear
   ```

### Q: 시뮬레이션이 너무 느려요

**A**:

1. 업데이트 간격 증가:
   ```bash
   # .env 파일에서
   SIMULATION_UPDATE_INTERVAL_SEC=30
   ```

2. 실시간 AIS 비활성화:
   ```bash
   ENABLE_REAL_AIS=false
   ```

3. 선박 수 감소 (코드 수정 필요)

### Q: 모듈을 찾을 수 없다는 오류가 나요

**A**:

```bash
# 현재 디렉토리 확인
pwd

# 올바른 디렉토리에서 실행하는지 확인
cd 007_/maritime_comm_simulator_2030

# 의존성 재설치
pip install -r requirements.txt --force-reinstall
```

### Q: Python 버전 오류

**A**: Python 3.10 이상 필요:

```bash
python --version  # 3.10 이상인지 확인

# pyenv 사용 (권장)
pyenv install 3.10.11
pyenv local 3.10.11
```

---

## 고급 사용

### 데이터 내보내기

위반 로그를 JSON으로 내보내기:

```python
from simulation_smr import SMRVesselSimulator

# 시뮬레이션 실행 후
simulator.export_violation_log("violations.json")
```

### 커스텀 항로 생성

`simulation_ammonia.py`에서:

```python
from simulation_ammonia import Route, Waypoint

custom_route = Route(
    route_name="Custom Route",
    waypoints=[
        Waypoint(lat1, lon1, "Start", 15.0),
        Waypoint(lat2, lon2, "Middle", 17.0),
        Waypoint(lat3, lon3, "End", 10.0)
    ]
)
```

### 통신 프로파일 커스터마이징

```python
from scenario_controller import CommunicationProfile, CommunicationType

custom_profile = CommunicationProfile(
    comm_type=CommunicationType.VSAT,
    latency_mean_ms=300,
    latency_std_ms=50,
    packet_loss_good_state=0.01,
    packet_loss_bad_state=0.25,
    prob_good_to_bad=0.04,
    prob_bad_to_good=0.18,
    normal_update_interval_sec=8,
    degraded_update_interval_sec=25,
    critical_update_interval_sec=90
)
```

---

## 성능 최적화

### 대용량 선박 처리

```python
# config.py에서 조정
config.simulation_speed_multiplier = 2.0  # 2배속 시뮬레이션
config.update_interval_sec = 20  # 업데이트 주기 증가
```

### 메모리 사용 최적화

```python
# 히스토리 버퍼 크기 제한
MAX_HISTORY_SIZE = 1000  # 최근 1000개만 유지
```

---

## 추가 리소스

- **AIS 메시지 형식**: [ITU-R M.1371](https://www.itu.int/rec/R-REC-M.1371/)
- **Dead Reckoning 이론**: [Navigation Theory](https://en.wikipedia.org/wiki/Dead_reckoning)
- **Gilbert-Elliott 모델**: [Packet Loss Models](https://en.wikipedia.org/wiki/Gilbert%E2%80%93Elliott_model)

---

## 라이선스 및 면책

이 시뮬레이터는 **연구 및 교육 목적**으로만 사용됩니다.

- 실제 항해 또는 상업적 선박 추적에 사용하지 마세요
- SMR 선박은 가상 시나리오입니다
- AIS 데이터는 AISStream 이용약관을 준수해야 합니다

---

**문의**: 기술적 질문은 GitHub Issues에 올려주세요.
