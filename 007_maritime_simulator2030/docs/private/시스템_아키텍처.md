# Maritime Communication Simulation Platform - Architecture Document

## Executive Summary

This platform evaluates the sufficiency of AIS + satellite communication infrastructure for a 2030 mixed-fleet environment through rigorous simulation and real-world data integration.

---

## System Architecture

### Layer 1: Data Acquisition Layer

#### 1.1 Real-Time AIS Stream (ais_client.py)
- **Protocol**: WebSocket (wss://stream.aisstream.io/v0/stream)
- **Authentication**: API key-based
- **Filtering**: MMSI-based whitelist for Q-Max vessels
- **Message Types**: Position reports (Type 1, 2, 3), Static data (Type 5)
- **Normalization**: Convert AIS binary payloads to standardized vessel state objects

**Key Design Decisions**:
- Non-blocking async WebSocket client
- Message buffer with overflow protection
- Automatic reconnection with exponential backoff
- Thread-safe queue for inter-module communication

#### 1.2 Simulated Vessel Generators

**Ammonia Vessels (simulation_ammonia.py)**:
- Route-based waypoint navigation
- Configurable speed profiles
- Probabilistic signal blackout injection
- Great Circle navigation between waypoints

**SMR Vessel (simulation_smr.py)**:
- Corridor-constrained movement
- Geo-fence boundary enforcement
- High-precision nuclear safety compliance zone monitoring
- Deviation event logging

---

### Layer 2: Prediction & Analysis Layer

#### 2.1 Dead Reckoning Engine (prediction_engine.py)

**Mathematical Foundation**:

Dead Reckoning predicts vessel position during AIS signal loss using last known state:

```
Position Prediction:
φ₂ = asin(sin(φ₁)·cos(δ) + cos(φ₁)·sin(δ)·cos(θ))
λ₂ = λ₁ + atan2(sin(θ)·sin(δ)·cos(φ₁), cos(δ) - sin(φ₁)·sin(φ₂))

where:
  φ = latitude (radians)
  λ = longitude (radians)
  δ = angular distance = d/R (d=distance, R=Earth radius)
  θ = true course (radians)
```

**Error Accumulation Model**:

```
Positional Error (CEP - Circular Error Probable):

σ_total(t) = √(σ_sensor² + σ_course² · t² + σ_speed² · t²)

Components:
  σ_sensor: Base AIS sensor accuracy (~10m for Class A)
  σ_course: Course uncertainty (±2° typical)
  σ_speed: Speed uncertainty (±0.1 knots)
  t: Time since last position fix (seconds)

Confidence Radius (95%):
  r₉₅(t) = 2.45 · σ_total(t)
```

**Environmental Drift Factors**:
- Wind drift coefficient: 0.03 × wind_speed
- Current drift: Direct vector addition
- Sea state degradation factor

#### 2.2 Communication Reliability Metrics

**Signal Availability Index (SAI)**:
```
SAI = (T_connected / T_total) × 100%

where T_connected = Σ(duration of successful signal periods)
```

**Position Freshness Score (PFS)**:
```
PFS(t) = e^(-λ·Δt)

where:
  λ = decay constant (typical: 0.1 per minute)
  Δt = time since last valid position update (minutes)
```

**Mean Positional Error (MPE)**:
```
MPE = (1/N) · Σ|r_predicted - r_actual|

where N = number of validation samples
```

---

### Layer 3: Scenario Control Layer

#### 3.1 Communication Degradation Scenarios (scenario_controller.py)

**Configurable Parameters**:

1. **Latency Injection**:
   ```
   T_delayed = T_actual + N(μ, σ²)

   Typical ranges:
   - VSAT: μ=500ms, σ=100ms
   - LEO Satellite: μ=30ms, σ=10ms
   - AIS terrestrial: μ=2s, σ=500ms
   ```

2. **Packet Loss Modeling**:
   ```
   P_loss = f(elevation_angle, sea_state, vessel_type)

   Gilbert-Elliott Model:
   - Good state: P_loss = 0.01
   - Bad state: P_loss = 0.40
   - Transition probabilities: P_GB, P_BG
   ```

3. **Update Frequency Throttling**:
   - Normal: 2-10 seconds (Class A AIS)
   - Degraded: 30-180 seconds
   - Critical: >300 seconds

4. **Geo-fence Enforcement**:
   ```
   Inside_Fence(position) = Point-in-Polygon test

   Using ray-casting algorithm:
   - Cast ray from point to infinity
   - Count polygon edge intersections
   - Odd count = inside, Even = outside
   ```

---

### Layer 4: Visualization Layer

#### 4.1 Interactive Map Interface (app.py)

**Rendering Components**:

1. **Vessel Markers**:
   - Color-coded by type (LNG: blue, Ammonia: green, SMR: red)
   - Size proportional to vessel dimensions
   - Rotation based on course over ground (COG)

2. **Error Radius Circles**:
   - Opacity based on confidence level
   - Radius = r₉₅(t) from prediction engine
   - Color intensity = position freshness score

3. **Route Traces**:
   - Historical path (last 24h)
   - Predicted trajectory (next 6h)
   - Waypoint markers

4. **Communication Status Indicators**:
   - Real-time signal strength meter
   - Last update timestamp
   - Blackout event timeline

5. **Analytical Dashboards**:
   - Time-series graphs: position error vs. time
   - Histogram: signal blackout duration distribution
   - Heatmap: communication reliability by geographic region

---

## Data Flow Architecture

```
┌─────────────────┐
│  AISStream API  │
└────────┬────────┘
         │ WebSocket
         ▼
┌─────────────────┐       ┌──────────────────┐
│  ais_client.py  │       │  simulation_*.py │
│  (Live Q-Max)   │       │  (Synthetic)     │
└────────┬────────┘       └────────┬─────────┘
         │                         │
         └─────────┬───────────────┘
                   │
                   ▼
         ┌─────────────────────┐
         │  Unified Vessel     │
         │  State Manager      │
         └─────────┬───────────┘
                   │
         ┌─────────┼───────────┐
         │         │           │
         ▼         ▼           ▼
  ┌──────────┐ ┌──────────┐ ┌──────────────┐
  │Prediction│ │Scenario  │ │Metrics       │
  │Engine    │ │Controller│ │Calculator    │
  └─────┬────┘ └────┬─────┘ └──────┬───────┘
        │           │               │
        └───────────┼───────────────┘
                    │
                    ▼
          ┌──────────────────┐
          │  app.py          │
          │  (Streamlit UI)  │
          └──────────────────┘
```

---

## Module Dependency Graph

```
ais_client.py
    ├─→ websocket-client
    └─→ threading.Queue

simulation_ammonia.py
    ├─→ geopy
    └─→ numpy

simulation_smr.py
    ├─→ shapely
    └─→ geopy

prediction_engine.py
    ├─→ numpy
    ├─→ scipy
    └─→ math

scenario_controller.py
    ├─→ prediction_engine
    └─→ random

app.py
    ├─→ streamlit
    ├─→ folium/pydeck
    ├─→ ais_client
    ├─→ simulation_*
    ├─→ prediction_engine
    └─→ scenario_controller
```

---

## Performance Considerations

### Scalability Targets
- **Concurrent vessels**: 100+ without lag
- **Update frequency**: 10 Hz processing capacity
- **Historical data**: 7-day buffer in memory
- **Map rendering**: <500ms for full redraw

### Optimization Strategies
1. **Spatial indexing**: R-tree for vessel proximity queries
2. **Update throttling**: Only recompute visible vessels
3. **Lazy evaluation**: Calculate prediction only when requested
4. **Vectorization**: NumPy for batch geo-calculations

---

## Security & Data Integrity

### AISStream Connection
- TLS 1.3 encrypted WebSocket
- API key stored in environment variables (not hardcoded)
- Rate limiting compliance (per AISStream ToS)

### Simulated Data Markers
- All synthetic vessels flagged with `is_simulated=True`
- MMSI ranges: 9XX XXX XXX (reserved for experimental use)
- Visual distinction in UI (simulated = dashed border)

---

## Validation Methodology

### Position Accuracy Validation
1. Compare predicted positions against actual AIS updates
2. Calculate Root Mean Square Error (RMSE)
3. Statistical analysis: mean, median, 95th percentile error

### Communication Reliability Validation
1. Measure actual vs. expected update intervals
2. Identify blackout patterns (geographic, temporal)
3. Correlate with vessel speed/heading changes

### Geo-fence Performance Validation
1. Test boundary crossing detection latency
2. Measure false positive/negative rates
3. Validate polygon containment algorithm accuracy

---

## Implementation Priority Order

**Phase 1 - Foundation** (Week 1):
1. `ais_client.py` - Establish real-world data pipeline
2. `prediction_engine.py` - Core mathematical engine
3. Basic vessel state data models

**Phase 2 - Simulation** (Week 2):
4. `simulation_ammonia.py` - Route-based movement
5. `simulation_smr.py` - Corridor constraints
6. Integration with prediction engine

**Phase 3 - Control** (Week 3):
7. `scenario_controller.py` - Degradation scenarios
8. Metrics collection framework
9. Data logging infrastructure

**Phase 4 - Visualization** (Week 4):
10. `app.py` - Interactive map
11. Dashboard components
12. Real-time metrics display

---

## Research Questions Addressed

1. **Can AIS handle mixed-fleet density?**
   - Metric: Message collision rate under concurrent updates
   - Threshold: <5% packet loss acceptable

2. **Is Dead Reckoning sufficient during blackouts?**
   - Metric: Position error >500m triggers re-routing
   - Acceptance: 95% accuracy within 10-minute blackout

3. **Do geo-fences work reliably?**
   - Metric: Detection latency <30 seconds
   - Acceptance: Zero missed boundary crossings

4. **What is the communication reliability baseline?**
   - Metric: SAI >95% for critical vessels
   - Benchmark: Compare VSAT vs. LEO satellite

---

## Future Enhancement Pathways

1. **Machine Learning Integration**:
   - LSTM for trajectory prediction
   - Anomaly detection for deviation events
   - Weather impact classification

2. **Multi-Agent Collision Avoidance**:
   - COLREGS compliance checking
   - Closest Point of Approach (CPA) calculation
   - Automated evasive maneuver suggestion

3. **Satellite Coverage Modeling**:
   - LEO constellation orbital mechanics
   - Signal availability prediction
   - Handover event simulation

4. **Cyber-Security Scenarios**:
   - AIS spoofing detection
   - GPS jamming impact analysis
   - Communication integrity verification

---

## Compliance & Standards

- **IEC 61162**: Maritime navigation and radio communication
- **ITU-R M.1371**: AIS technical characteristics
- **SOLAS Chapter V**: Carriage requirements for AIS
- **IALA Guideline 1082**: AIS service overview

---

## License & Usage Restrictions

- **Research-only**: Not for commercial vessel tracking
- **AISStream**: Comply with free tier rate limits
- **Data Privacy**: No PII collection or transmission
- **Export Control**: No military or surveillance applications

---

**Document Version**: 1.0
**Last Updated**: 2026-01-24
**Author**: Maritime Systems Architecture Team
